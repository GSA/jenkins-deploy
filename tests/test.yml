---
- hosts: all
  name: Set up Jenkins
  remote_user: ec2-user
  become: true
  pre_tasks:
    - set_fact:
        jenkins_external_hostname: "{{ inventory_hostname }}"
  roles:
    # needs to match repository name
    - jenkins-deploy
  tasks:

    - name: Set up pipeline
      jenkins_job:
        config: "{{ lookup('file', 'files/job.xml') }}"
        name: test-auto
        user: "{{ jenkins_admin_username }}"
        password: "{{ jenkins_admin_password }}"
